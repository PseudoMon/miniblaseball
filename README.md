# MiniBlaseball Website
Hullo, this repository is for the code that runs the [#MiniBlaseball website](https://miniblaseball.surge.sh). I wrote this readme for my future self so I don't get lost if I want to get back to this, and well, I guess also for anyone who wants to help fix bugs or to develop it further!

The website is built with Riot and Rollup. It's designed to only run only in the frontend from a single file and a single address. Data for the players is handwritten in the filename and the metadata file which is written using the [Eno notation language](https://eno-lang.org/). These data is then collated with some Python scripting and exported into a JSON which is then loaded into the app.

I've no plans to further automate data processing or to add more data into the site e.g. star rating or forbidden information, but I'm open if you want to help develop it.  

Note that this repository does not contain the images!

## Requirements
If you want to run the scripts that generate players data, you'll need Python 3 and the Python enolib package.

For the website, you'll need a recent version of Node and a Node package manager. I use PNPM, but it should work the same way if you use NPM or other package manager that uses the same package.json format.

You'll need something to run a server from the `dist` directory. I use Python's builtin simple server, but anything else will work. 

## Generating player data
You can find the generated players data in `src/players.json` and `src/guestPlayers.json`. 

Those files are created by running  `python processplayers.py` inside `dist/images`. Players's names and sprites are determined from the images and their filename. Size determination is (for now) manually coded into the script. Other metadata is in `dist/images/extradata.eno`

Image filename should be in the format e.g. `98JoshuaWatson.png`, with alt color schemes being e.g. `98JoshuaWatsonALT.png` and `98JoshuaWatsonALT2.png`. The script has manual adjustments for some players, like NaN or Y3hirv and those with "Mc" in their name (e.g. McDowell Mason). We use UTF-8 encoding, so non-English letters should work as well (thanks Jes√∫s Koch). 

A player's "size" decides where the cut-off will be when viewing the player's page. Most players are probably `small`, some are `large`, and for a couple few, they need to be slightly larger than large: `xlarge`. The maximum is Peanutiel Duffy's `huge`.

Team's name data should be manually inputted into `teams.eno`. Running `processplayers.json` will also create the file containing teams data: `src/teams.json` and `src/guestTeams.json`. 

## Running the website on your machine
Install the requirements with this (or however your package manager install packages).

```
pnpm install
``` 

And then run rollup from the configuration file

```
rollup -c -w
```

That will pack all the JavaScript source code into a single `app.js` file in the `dist` folder, which is then read by `index.html` when you open the website. The website functions rely on being run from a server based on that `dist` folder, so you'll have to run a server based on that directory. I use Python, so I can just `cd dist` and then run this :

```
python -m http.server
```

Alternatively, you can run the script `startserver.sh` from the `dist` folder and it will both rebuild the players' JSON data and run a a server.

## The website's source code
Source code that pertains to the site are all inside the `src` folder. Most of the processing happens in the main `app.riot` file, with some components having their own component files. `players.json` contains players data and should be generated by the Python script. `teams.json` contains the teams divided by subleagues, to be displayed in the filter menu. Both these files should be created through the Python script.

`teamsReverseId.js` contain codes that flatten that teams JSON into a single array, and then transform that array into an object in which team names become keys and their values is their index within that array. It's for sorting by teams, so we can just compare their team index.

## Readying for production
Run rollup without using watch. It'll result in a minified production-ready file.
```
rollup -c
```

The current website is hosted on [Surge.sh](https://surge.sh)! If you have upload rights, you can upload using 
```
surge --domain miniblaseball.surge.sh
```

We also occasionally use the domain `zion-aliciakeyes.surge.sh` for testing new features.

## Known Bugs
Changing the player page currently seen by typing directly to the URL will not change data that are processed before they're rendered (including former teams and alt sprites). This is because states of the PlayerInfo component is not re-processed. Find a way to fix this maybe.  