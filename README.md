# MiniBlaseball Website
Hullo! This repository contains the code that runs the [#MiniBlaseball website](https://miniblaseball.surge.sh). If you see any functional bugs or if you want to suggest new features, feel free to open an issue! Feel free to also contact me on [Twitter](https://twitter.com/PseudoMonious). 

The website is built with [Svelte](https://svelte.dev), utilizing single-page routing with [Svelte Navigator](https://github.com/mefechoel/svelte-navigator). Data for the players is handwritten in a metadata file which is written using the [Eno notation language](https://eno-lang.org/). These data is then collated with some Python scripting and exported into a JSON which is then loaded into the app.

I've no plans to further automate data processing or to add more data into the site e.g. star rating or forbidden information, but I'm open if you want to help develop it.  

Note that this repository does not contain the images!

## Requirements
If you want to run the scripts that generate players data, you'll need Python 3 and the Python enolib package.

For the website, you'll need a recent version of Node and a Node package manager. I use PNPM, but it should work the same way if you use NPM or other package manager that uses the same package.json format.

## Generating player data
You can find the generated players data in `src/players.json` and `src/guestPlayers.json`. Team data can be found in `src/teams.json` and `src/guestTeams.json`. 

To generate this data, go to `dist/images` and run

```
python scripts/processplayers.py
```

Players's names and sprites are determined from the images and their filename. Size determination is (for now) manually coded into `processplayers.py`. Other metadata is written in `dist/images/scripts/extradata.eno`

Image filename should be in the format e.g. `111ChorbyShort.png`, with alt color schemes being e.g. `111ChorbyShortALT.png` and `111ChorbyShortALT2.png`.  Alternate designs should have a number after the full name, before the ALT e.g. `111ChorbyShort2.png`, `111ChorbyShort2ALT.png`. 

The script also contains manual adjustments for some players, like NaN or Y3hirv. We use UTF-8 encoding, so non-English letters should work as well (thanks for reminding me, Jes√∫s Koch). 

A player's "size" decides where the cut-off will be when viewing the player's page. Most players are probably `small`, some are `large`, and for a couple few, they need to be slightly larger than large: `xlarge`. The maximum is Peanutiel Duffy's `huge`.

Team's name data are contained inside `teams.eno`.

## Running the website on your machine
Install the requirements with this (or however your package manager install packages).

```
pnpm install
``` 

And then simply run this

```
pnpm run dev
```

Replace pnpm with npm or whatever package manager you have. If you don't use PNPM, in `rollup.config.js`, find and replace the word `pnpm` with the package manager you use (e.g. `npm`).

That script will run a server running in `localhost:5000`. The page will reload automatically whenever any of the code changes.

Note that players data (e.g. `players.json`) will still have to be rebuilt through the Python script whenever there are new players or changes to `extradata.eno`. 


## The website's source code
Source code that pertains to the site are all inside the `src` folder. Most of the processing happens in the main `app.svelte`. 

Machine-readable players data is contained within `players.json`, which should be generated by the Python script. `teams.json` contains the teams divided by subleagues, to be displayed in the filter menu. Both these files should be created through the Python script.

`teamsReverseId.js` contain codes that flatten that teams JSON into a single array, and then transform that array into an object in which team names become keys and their values is their index within that array. It's for sorting by teams, so we can compare their team index.

## Readying for production
Run this script (or the equivalent with your package manager):

```
pnpm run build
```

This will result in minified production-ready files in the `dist` folder.

The current website is hosted on [Surge.sh](https://surge.sh)! If you have upload rights, you can go to the `dist` folder and upload using 
```
surge --domain miniblaseball.surge.sh
```

We also occasionally use the domain `zion-aliciakeyes.surge.sh` for testing new features.

Note the existence of `200.html` file which is identical to `index.html`. When using Surge.sh, [this will enable client-side routing](https://surge.sh/help/adding-a-200-page-for-client-side-routing). 